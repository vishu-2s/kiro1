# Multi-Agent Security Analysis System - End-to-End Flow Diagram

## 🎯 High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              USER INPUT                                              │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                           │
│  │   GitHub     │    │    Local     │    │    SBOM      │                           │
│  │ Repository   │    │  Directory   │    │    File      │                           │
│  │   URL        │    │    Path      │    │   (.json)    │                           │
│  └──────┬───────┘    └──────┬───────┘    └──────┬───────┘                           │
│         │                   │                   │                                    │
│         └───────────────────┼───────────────────┘                                    │
│                             ▼                                                        │
└─────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         🌐 WEB UI (Flask - app.py)                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │  • Live Progress Bar        • Real-time Log Streaming                       │    │
│  │  • Ecosystem Selection      • Configuration Options                         │    │
│  │  • Interactive Report       • Backup/Restore History                        │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                    📊 DATA COLLECTION & SBOM GENERATION                              │
│                                                                                      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐                  │
│  │  GitHub Tools   │    │  Local Tools    │    │   SBOM Tools    │                  │
│  │  • Clone repo   │    │  • Scan files   │    │  • Parse JSON   │                  │
│  │  • Fetch data   │    │  • Find deps    │    │  • Validate     │                  │
│  └────────┬────────┘    └────────┬────────┘    └────────┬────────┘                  │
│           │                      │                      │                           │
│           └──────────────────────┼──────────────────────┘                           │
│                                  ▼                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                    📦 DEPENDENCY GRAPH BUILDER                               │    │
│  │  • Extract all packages (direct + transitive)                               │    │
│  │  • Build dependency tree                                                    │    │
│  │  • Detect circular dependencies                                             │    │
│  │  • Identify version conflicts                                               │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│              ⚡ LAYER 1: RULE-BASED DETECTION (Fast, Deterministic)                  │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                     ECOSYSTEM ANALYZERS                                      │    │
│  │  ┌─────────────────────┐         ┌─────────────────────┐                    │    │
│  │  │    npm Analyzer     │         │   Python Analyzer   │                    │    │
│  │  │  • package.json     │         │  • setup.py         │                    │    │
│  │  │  • install scripts  │         │  • requirements.txt │                    │    │
│  │  │  • postinstall      │         │  • pyproject.toml   │                    │    │
│  │  └─────────────────────┘         └─────────────────────┘                    │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                     PATTERN DETECTION                                        │    │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │    │
│  │  │  Malicious   │ │ Typosquat    │ │  Obfuscated  │ │  Suspicious  │        │    │
│  │  │  Patterns    │ │  Detection   │ │    Code      │ │   Scripts    │        │    │
│  │  │              │ │              │ │              │ │              │        │    │
│  │  │ • eval()     │ │ • lodash vs  │ │ • Base64     │ │ • curl|bash  │        │    │
│  │  │ • exec()     │ │   lodahs     │ │ • Hex encode │ │ • wget -O-   │        │    │
│  │  │ • os.system  │ │ • requests   │ │ • String     │ │ • Remote     │        │    │
│  │  │ • subprocess │ │   vs reqests │ │   concat     │ │   execution  │        │    │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘        │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                    🔍 VULNERABILITY DATABASE QUERIES                                 │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                    PARALLEL OSV QUERIES (Async)                              │    │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                      │    │
│  │  │  OSV.dev    │    │   Snyk DB   │    │  Malicious  │                      │    │
│  │  │  Database   │    │  (Optional) │    │  Pkg Cache  │                      │    │
│  │  │             │    │             │    │             │                      │    │
│  │  │ • CVEs      │    │ • Vulns     │    │ • Known bad │                      │    │
│  │  │ • Advisories│    │ • Exploits  │    │   packages  │                      │    │
│  │  └─────────────┘    └─────────────┘    └─────────────┘                      │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                    💾 INTELLIGENT CACHING (SQLite)                           │    │
│  │  • 10x performance boost on repeat scans                                    │    │
│  │  • 90% API cost reduction                                                   │    │
│  │  • TTL-based expiration (configurable)                                      │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│              🤖 LAYER 2: MULTI-AGENT ANALYSIS (AI-Powered)                          │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                         ORCHESTRATOR                                         │    │
│  │           Coordinates agents, manages timeouts, handles failures             │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                              │                                                       │
│              ┌───────────────┴───────────────┐                                      │
│              ▼                               ▼                                       │
│  ┌─────────────────────────┐    ┌─────────────────────────┐                         │
│  │  🔎 SUPPLY CHAIN        │    │  🧬 SYNTHESIS           │                         │
│  │     DETECTOR AGENT      │    │     AGENT               │                         │
│  │                         │    │                         │                         │
│  │  • Web intelligence     │───▶│  • Merge all findings   │                         │
│  │  • Malicious pkg check  │    │  • Deduplicate          │                         │
│  │  • Reputation scoring   │    │  • Calculate severity   │                         │
│  │  • Threat correlation   │    │  • Generate report      │                         │
│  └─────────────────────────┘    └─────────────────────────┘                         │
│                                              │                                       │
└──────────────────────────────────────────────┼──────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                    🧠 LLM RECOMMENDATIONS (GPT-4o-mini)                              │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │  INPUT: All findings + context                                               │    │
│  │                                                                              │    │
│  │  OUTPUT:                                                                     │    │
│  │  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐             │    │
│  │  │ 🚨 IMMEDIATE     │ │ 🛡️ PREVENTIVE    │ │ 📊 MONITORING    │             │    │
│  │  │    ACTIONS       │ │    MEASURES      │ │    PRACTICES     │             │    │
│  │  │                  │ │                  │ │                  │             │    │
│  │  │ • Fix critical   │ │ • Add to CI/CD   │ │ • Track metrics  │             │    │
│  │  │   vulns in 24h   │ │ • Use lockfiles  │ │ • Set alerts     │             │    │
│  │  │ • Remove pkg X   │ │ • Pin versions   │ │ • Regular audits │             │    │
│  │  └──────────────────┘ └──────────────────┘ └──────────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                               │
                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         📋 OUTPUT: SECURITY REPORT                                   │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                         REPORT STRUCTURE                                     │    │
│  │                                                                              │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │    │
│  │  │  METADATA   │  │   SUMMARY   │  │  FINDINGS   │  │   ACTIONS   │         │    │
│  │  │             │  │             │  │             │  │             │         │    │
│  │  │ • Timestamp │  │ • Total: 47 │  │ • Package   │  │ • Immediate │         │    │
│  │  │ • Target    │  │ • Critical:2│  │ • Severity  │  │ • Preventive│         │    │
│  │  │ • Duration  │  │ • High: 5   │  │ • Evidence  │  │ • Monitoring│         │    │
│  │  │ • Ecosystem │  │ • Medium:12 │  │ • CVE IDs   │  │             │         │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                         OUTPUT FORMATS                                       │    │
│  │  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                   │    │
│  │  │  📄 JSON     │    │  🌐 Web UI   │    │  📊 CI/CD    │                   │    │
│  │  │   Report     │    │   Dashboard  │    │   Exit Code  │                   │    │
│  │  └──────────────┘    └──────────────┘    └──────────────┘                   │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 Simplified Flow (For Quick Reference)

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  INPUT   │───▶│  PARSE   │───▶│  DETECT  │───▶│ ANALYZE  │───▶│  REPORT  │
│          │    │          │    │          │    │          │    │          │
│ • GitHub │    │ • SBOM   │    │ • Rules  │    │ • AI     │    │ • JSON   │
│ • Local  │    │ • Deps   │    │ • OSV    │    │ • LLM    │    │ • Web UI │
│ • SBOM   │    │ • Graph  │    │ • Snyk   │    │ • Synth  │    │ • CI/CD  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘    └──────────┘
     │               │               │               │               │
     │               │               │               │               │
   ~5 sec         ~10 sec         ~30 sec         ~15 sec         ~5 sec
                                                              
                        TOTAL: ~60-90 seconds
```

---

## 🎯 Detection Capabilities Matrix

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         WHAT WE DETECT                                               │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  🔴 CRITICAL                    🟠 HIGH                      🟡 MEDIUM              │
│  ─────────────────────         ─────────────────────        ─────────────────────   │
│  • Remote code execution       • Obfuscated code            • Low reputation pkg    │
│  • Known malicious packages    • Suspicious scripts         • Outdated dependencies │
│  • Backdoor installation       • Credential theft           • Missing lockfiles     │
│  • Data exfiltration           • Crypto mining              • Typosquatting risk    │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                         EXAMPLE PATTERNS                                     │    │
│  │                                                                              │    │
│  │  npm:                              Python:                                   │    │
│  │  ─────                             ───────                                   │    │
│  │  • "preinstall": "curl | bash"     • os.system("curl | bash")               │    │
│  │  • eval(Buffer.from('...'))        • exec(base64.b64decode('...'))          │    │
│  │  • require('child_process')        • subprocess.call(['wget', ...])         │    │
│  │  • fetch('http://evil.tk/...')     • urllib.request.urlopen('...')          │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 📊 Reputation Scoring Formula

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         REPUTATION SCORE (0.0 - 1.0)                                 │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                                                                              │    │
│  │   SCORE = (Age × 0.30) + (Downloads × 0.30) + (Author × 0.20) + (Maint × 0.20)   │
│  │                                                                              │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
│  │  📅 AGE      │  │  📈 DOWNLOADS│  │  👤 AUTHOR   │  │  🔧 MAINT    │             │
│  │   (30%)     │  │    (30%)     │  │    (20%)     │  │    (20%)     │             │
│  │             │  │              │  │              │  │              │             │
│  │ <30d: 0.2   │  │ <100/w: 0.2  │  │ Unknown: 0.3 │  │ >2yr: 0.2    │             │
│  │ 30-90d: 0.5 │  │ 100-1K: 0.5  │  │ New: 0.5     │  │ 1-2yr: 0.5   │             │
│  │ 90d-1y: 0.7 │  │ 1K-10K: 0.7  │  │ Estab: 0.8   │  │ 6-12mo: 0.7  │             │
│  │ 1-2y: 0.9   │  │ 10K-100K:0.9 │  │ Verified: 1.0│  │ <6mo: 1.0    │             │
│  │ >2y: 1.0    │  │ >100K: 1.0   │  │              │  │              │             │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘             │
│                                                                                      │
│  RISK THRESHOLDS:  🔴 <0.3 HIGH RISK  │  🟡 0.3-0.6 MEDIUM  │  🟢 >0.6 LOW RISK    │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🚀 Performance Metrics

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         PERFORMANCE COMPARISON                                       │
│                                                                                      │
│  WITHOUT CACHE                          WITH CACHE (SQLite)                         │
│  ──────────────                         ───────────────────                         │
│                                                                                      │
│  ┌─────────────────────┐               ┌─────────────────────┐                      │
│  │  First Scan: 90s    │               │  First Scan: 90s    │                      │
│  │  Second Scan: 90s   │               │  Second Scan: 9s    │  ← 10x FASTER        │
│  │  API Calls: 100%    │               │  API Calls: 10%     │  ← 90% REDUCTION     │
│  │  Cost: $$$          │               │  Cost: $            │                      │
│  └─────────────────────┘               └─────────────────────┘                      │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🎨 Color Legend for Presentation

```
🔴 CRITICAL  - Immediate action required (red)
🟠 HIGH      - Address within 48 hours (orange)  
🟡 MEDIUM    - Review when possible (yellow)
🟢 LOW       - Minor issues (green)
🔵 INFO      - Informational (blue)
```

---

## 📱 One-Slide Summary (For Busy Executives)

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                      │
│     🛡️ MULTI-AGENT SECURITY ANALYSIS SYSTEM                                         │
│                                                                                      │
│     ┌─────────────────────────────────────────────────────────────────────────┐     │
│     │                                                                          │     │
│     │   INPUT          →    ANALYZE         →    OUTPUT                        │     │
│     │   ─────               ───────              ──────                        │     │
│     │   • GitHub            • Rules + AI         • Security Report             │     │
│     │   • Local             • OSV/Snyk           • Recommendations             │     │
│     │   • SBOM              • Reputation         • CI/CD Integration           │     │
│     │                                                                          │     │
│     └─────────────────────────────────────────────────────────────────────────┘     │
│                                                                                      │
│     ✅ npm + Python        ✅ 60-90 sec scan      ✅ AI recommendations             │
│     ✅ 10x cache speedup   ✅ Web UI + CLI        ✅ Actionable findings            │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```
